<html>
<head>
<title>Search</title>

<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase.js"></script>

<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDkJap-l-nEEa8_Up_fRyBKadFLO8PzKQM",
    authDomain: "miraclemessages-v2.firebaseapp.com",
    databaseURL: "https://miraclemessages-v2.firebaseio.com",
    projectId: "miraclemessages-v2",
    storageBucket: "miraclemessages-v2.appspot.com",
    messagingSenderId: "669586730683"
  };
  app = firebase.initializeApp(config);
</script>

</head>
<body>

<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-database.js"></script>

<script lang="text/javascript">
var db = firebase.database(app);
var checkFrom = "";
var query;

function searchFilter(snapshot)
{

    var contents = "";
    allData = snapshot.val();

    for (k in allData)
    {
        oneCase = allData[k];    // JSON
        // var dump = document.getElementById("results");
        //find the appropriate field to check, if it contains the query, put it into the list to return
        var checking;
        if (checkFrom === 'deliveryStatus'){
           checking = oneCase.deliveryStatus;
           if (checking == query){
                contents += oneCase.caseID + '\n';
           }
        }
        else {
            if (checkFrom === 'name'){
              checking = String(oneCase.name).toLowerCase();
          }
          else if (checkFrom === 'volunteerName'){
              checking = String(oneCase.volunteerName).toLowerCase();
          }
          if (checking.includes(query.toLowerCase())){
                    contents += oneCase.caseID + '\n';
          }
        }


    }

    var dump = document.getElementById("results");
    dump.innerHTML = contents;
}

function search()
{
    contents = "";
    var dump = document.getElementById("results");

    var myform = document.getElementById("newsearch");
    query = myform.elements["query"].value
    // dump.innerHTML = el;

    var fld = myform.elements["type"].value; // type
    // dump.innerHTML = fld.value;
    if (fld === 'client'){
            searchFrom = 'clients';
            checkFrom = 'name';
    }
    else if (fld === 'volunteer'){
            searchFrom = 'volunteers';
            checkFrom = 'volunteerName';
    }
    else if(fld === 'status'){
      searchFrom = 'cases';
      checkFrom = 'deliveryStatus';
      var sel = myform.elements["s_s"].value
      if (sel == 'undeliv'){
        query = 0;
      }
      else if (sel == 'deliv'){
        query = 1;
      }
      else if (sel == 'need'){
        query = -1;
      }
      else if (sel == 'no'){
        query = -2;
      }
    }
          // case 'case_date':
            // case_dateMatch = el; // where to get date from?
          // case 'worked_on_date':
            // worked_on_dateMatch = el; // where to get date from?

    var searchRef = db.ref(searchFrom);

    searchRef.orderByKey().on("value",searchFilter);

// });
}

</script>

<center><form id="newsearch">
  Search by

<select id="type" onchange="if (this.value=='status'){this.form['s_s'].style.visibility='visible'; this.form['query'].style.visibility='hidden'}else {this.form['s_s'].style.visibility='hidden';this.form['query'].style.visibility='visible'};">
<option value="" selected="selected">Select...</option>
<option value="client">Client name</option>
<option value="case_date">Date of case (MM/YY)</option> /* TODO month/year format */
<option value="volunteer">Volunteer name</option>
<option value="worked_on_date">Last worked on date (MM/YY)</option>
<option value="status">Delivery status</option> /* TODO options */
</select>
<input type="text" id="query" name="query" style="visibility:hidden;">
<select id="s_s" name="s_s" style="visibility:hidden;">
  <option value="undeliv">Undelivered</option>
  <option value="deliv">Delivered</option>
  <option value="need">Needs to be delivered</option>
  <option value="no">No delivery</option>
</select>
<input type="button" value="Search" onclick="search()">

</form>

<br>

Results:<br/>
	<textarea id="results" rows="20" cols="60" readonly></textarea>
  <!-- /* Link to view/edit/full log*/ -->
  <!-- case sensitivity -->
</form></center>
</body>
</html>
