<html>
<head>
<title>Web App</title>

<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDkJap-l-nEEa8_Up_fRyBKadFLO8PzKQM",
    authDomain: "miraclemessages-v2.firebaseapp.com",
    databaseURL: "https://miraclemessages-v2.firebaseio.com",
    projectId: "miraclemessages-v2",
    storageBucket: "miraclemessages-v2.appspot.com",
    messagingSenderId: "669586730683"
  };
  var app = firebase.initializeApp(config);
</script>

</head>
<body>

<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-database.js"></script>

<script lang="text/javascript">

function showAllData()
{
  alert("here");
  var rootRef = db.ref();
  var contents = "";
  rootRef.on('value', function(snap){contents += snap.val();});
  alert(contents);

  var dump = document.getElementById("allData");
  dump.innerHTML = contents;
}

function startInsert()
{
  var ua = document.getElementById("userArea");
  ua.src = "insert.html";
}

function visitSearch(){
  window.location='search.html';
}
function visitEdit(){
  window.location='edit.html';
}
function visitAdd(){
  window.location='https://miraclemessages.org/refer';
}
function visitMetrics(){
  window.location='metrics.html';
}
// function visitAdmin(){
//   window.location='/metrics.html';
// }


    var auth = firebase.auth(app);

    function signin_good(user)
    {
      console.log(user);

        // this function might get hit twice, first with user null
        if (user != null && user.uid.equals('5NGsBgjCngOZmX7ANHCM9r63xfD2'))
        // jess's UID
            window.location.href = "search.html";
        else (
            window.location.href = "volunteerCases.html";
        )
    }

    function signin_catch(error)
    {
        var errorCode = error.code;
        var errorMessage = error.message;
        alert(error.message);
    }

    function signin()
    {
        var email = document.getElementById("myname").value;
        var pword = document.getElementById("mypass").value;
        auth.signInWithEmailAndPassword(email, pword).catch(signin_catch).then(signin_good);
        auth.setPersistence(firebase.auth.Auth.Persistance.SESSION).then(
          function(){return auth.signInWithEmailAndPassword(email,pword).catch(signin_catch);}
                                                                          );
    }

  function showDiv() {
   document.getElementById('login').style.visibility = "visible";
  }

  function showDivCreate() {
   document.getElementById('create').style.visibility = "visible";
  }


  function createUser(){
    var email = document.getElementById("mynamec").value;
    var pword = document.getElementById("mypassc").value;
    auth.createUserWithEmailAndPassword(email, pword).then(function(user) {

    var user = firebase.auth().currentUser;
    console.log(user);
    addCase() // go to html page
    }, function(error) {
        console.log(error.code);
        var errorCode = error.code;
        var errorMessage = error.message;
    });
  }

  function addCase(){
    // go to cases corresponding to UID

  }
</script>

    <button type="button" id="search" onclick="visitSearch()">Search</button>
    <button type="button" id="edit" onclick="visitEdit()">Edit</button>
    <button type="button" id="add" onclick="visitAdd()">Add</button>
    <button type="button" id="metrics" onclick="visitMetrics()">Metrics</button>
    <button type="button" id="metrics" onclick="showDiv()">Login</button>
    <button type="button" id="metrics" onclick="showDivCreate()">Create New User</button>




    <!-- onchange="if (this.value=='status'){this.form['s_s'].style.visibility='visible';
this.form['query'].style.visibility='hidden'}else {this.form['s_s'].style.visibility='hidden';
this.form['query'].style.visibility='visible'};" -->
    <div id="login" style="visibility:hidden;">

    E-mail: <input type="text" id="myname"><br/>
    Password: <input type="text" id="mypass">
    <input type="button" value="Sign in" onclick="signin()">
  </div>
  <div id="create" style="visibility:hidden;">

  E-mail: <input type="text" id="mynamec"><br/>
  Password: <input type="text" id="mypassc">
  <input type="button" value="Create User" onclick="createUser()">
</div>
</body>
</html>
